{% extends "layouts/base.html" %}
{% block title %}Rule{% endblock %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
    <h1 class="h3 ">Rules</h1>
    <form action="{{ url_for('rules.index') }}" method="GET" class="d-flex ms-auto me-4">
        <div class="input-group">
            <input type="text" name="q" class="form-control" placeholder="Search symptom..."
                value="{{ request.args.get('q', '') }}">
            {% if request.args.get('q') %}
            <a href="{{ url_for('rules.index') }}" class="btn btn-outline-danger">X</a>
            {% endif %}
            <button class="btn btn-outline-secondary" type="submit"><i class="bi bi-search"></i></button>
        </div>
    </form>
    <a href="{{ url_for('rules.create') }}" class="btn btn-primary">New Rule</a>
</div>
{% if rules %}
<table class="table table-bordered table-striped align-middle">
    <thead>
        <tr>
            <th style="width: 50px;">#</th>
            <th>Code</th>
            <th>Title</th>
            <th>Category</th>
            <th>Symptom</th>
            <th>Confidence</th>
            <!-- <th>Created By</th> -->
            <th class="text-center">Actions</th>
        </tr>
    </thead>
    <tbody>
        {% for rule in rules %}
        <tr>
            <td>{{ loop.index }}</td>
            <td>
                <a href="{{ url_for('rules.detail', rule_id=rule.id) }}" class="text-decoration-none fw-semibold">
                    {{ rule.rule_id }}
                </a>
            </td>
            <td>{{ rule.title }}</td>
            <td>{{ rule.category }}</td>
            <td>
                {% if rule.facts %}
                <span class="badge bg-danger">
                    {{ rule.facts|length }} Symptom{{ rule.facts|length !=1 and 's' or '' }}
                </span>
                {% else %}
                <span class="badge bg-secondary">No permission</span>
                {% endif %}
            </td>
            <td>
                {{ (rule.confidence * 100)|round|int }} %
            </td>
            <!-- <td>
                {{ (rule.user.username if rule.user else 'Unknown') }}
            </td> -->
            <td class="text-center">
                <!-- Edit -->
                <a href="{{ url_for('rules.edit', rule_id=rule.id) }}" class="btn btn-sm btn-light text-dark border"
                    title="Edit">
                    <i class="bi bi-pencil"></i>
                </a>
                <!-- Delete (go to custom delete confirmation page) -->
                <button type="button" class="btn btn-sm btn-light border text-danger" data-bs-toggle="modal"
                    data-bs-target="#deleteModal" data-name="{{ rule.title }}" data-code="{{ rule.rule_id }}"
                    data-url="{{ url_for('rules.delete', rule_id=rule.id) }}"
                    data-message="Are you sure you want to delete this rule?">
                    <i class="bi bi-trash"></i></a>
                </button>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
<nav>
    <ul class="pagination justify-content-center">
        {% for page_num in pagination.iter_pages() %}
        {% if page_num %}
        <li class="page-item {{ 'active' if page_num == pagination.page }}">
            <a class="page-link" href="{{ url_for('rules.index', page=page_num, q=search_query) }}">
                {{ page_num }}
            </a>
        </li>
        {% else %}
        <li class="page-item disabled"><span class="page-link">...</span></li>
        {% endif %}
        {% endfor %}
    </ul>
</nav>
{% else %}
<p class="text-muted">No rule defined yet.</p>
{% endif %}
{% endblock %}